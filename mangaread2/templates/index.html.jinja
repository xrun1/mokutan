<!DOCTYPE html><html>
<head>
    <title>{{path.name or path}} | {{DISPLAY_NAME}}</title>

    <meta charset=utf-8>
    <meta name=viewport content="width=device-width">
    <meta name=referrer content=strict-origin>

    <link rel=stylesheet href=/style/main.css>
</head>

<body>
    {% include "nav.html.jinja" %}
    {% set progress = path.ocr_progress %}

    <div id=non-images>
        {% for path in path.non_images(sort) %}
            <a id={{path.as_anchor}} href="{{path.url(sort=sort)}}">
                <h4>{{path.name}}</h4>

                {% set progress = path.ocr_progress %}
                {% set prog_txt = path.ocr_progress_text %}
                {% set prog_shown = prog_txt %}
                {% if progress[0] == progress[1] or not progress[0] %}
                    {% set prog_shown = progress[1] %}
                {% endif %}
                {% set icon = "üóè " %}
                {% if path.ocr_running %} {% set icon = "‚èµ " %} {% endif %}
                {% if path.ocr_paused %} {% set icon = "‚è∏ " %} {% endif %}
                <span title="{{prog_txt}} OCR'ed">{{icon}}{{prog_shown}}</span>

                {% set dif = path.difficulty %}
                {% if dif %}
                    <span title="
Average words per page: {{dif[5]|round(1)}}
Unique words: {{dif[0]}}
Learned in Anki: {{dif[2]}} ({{(dif[2] / dif[0] * 100) | int}}%)
Mature: {{dif[3]}} ({{(dif[3] / dif[2] * 100) | int}}%)
Raw difficulty: {{(dif[1] + dif[4])|int}}
Anki decrease: {{dif[4]|int}} ({{(dif[4] / (dif[1] + dif[4]) * 100) | int}}%)
                    ">
                        üó≤&hairsp;{{dif[1]|int}}
                    </span>
                {% endif %}

                <img
                    alt="{{'üóÄ' if path.is_dir() else 'üóé'}}"
                    src="/thumbnail{{path.url()}}"
                    loading=lazy
                >
            </a>
        {% endfor %}
    </div>

    {% for img in path.images %}
        {% set anchor = img.stem.replace(' ', '') %}
        <h4>
            <a href="#{{img.as_anchor}}">{{img.name}}</a>
            {% if loop.index > progress[0] %}
                <a
                    href="{{force_refresh_url}}#{{img.as_anchor}}"
                    title="OCR in progress, click to refresh"
                >‚ü≥</a>
            {% endif %}
        </h4>

        <div class=page>
            <img id="{{img.as_anchor}}" src="{{img.url()}}" loading=lazy>

            {% for box in path.ocr_boxes(img) %}
                <p style="
                    left: {{box.x * 100}}%;
                    top: {{box.y * 100}}%;
                    min-width: {{box.w * 100}}%;
                    max-width: calc({{100 - box.x * 100}}% - 2rem);
                    min-height: {{box.h * 100}}%;
                    font-size: min(
                        {{box.font_size}}px,
                        {{box.font_size * 100 / box.image_w}}vw
                    );
                    {% if box.vertical %}
                        writing-mode: vertical-rl;
                    {% endif %}
                ">
                    {{"<br>".join(box.lines)}}
                </p>
            {% endfor %}
        </div>
    {% endfor %}

    {% include "nav.html.jinja" %}
</body></html>
