<h3>Anki</h3>

<form class=anki-connect action="/anki/load">
    <label>Address:
        <input type=url name=api
            value="{{anki.api or anki.DEFAULT_API}}">
    </label>
    <label>API Key:
        <input type=password name=key
            placeholder="Leave blank if not set up">
    </label>

    <input type=hidden name=referer value="{{request.url}}">

    {% if anki.loaded %}
        <button class=connect type="submit">Reload</button>
        <span class="anki-connected accent">✔ Connected</span>
    {% else %}
        <button class=connect type="submit">Connect</button>
    {% endif %}
</form>

<h4 class=anki-filters-title>Gather learned words from:</h4>

<table>
    <thead>
        <tr>
            <th>Deck</th>
            <th>Note Type</th>
            <th>Note Field</th>
            <th>Action</th>
        </tr>
    </thead><tbody>
    {% for filter in anki.filters %}
        <form class="anki-filter-row" action="/anki/filter/del">
            <tr>
                <td>
                    <select disabled><option>
                        {{"Any" if filter[0] == "*" else filter[0]}}
                    </option></select>
                </td>
                <td>
                    <select disabled><option>
                        {{filter[1]}}
                    </option></select>
                </td>
                <td>
                    <select disabled><option>
                        {{filter[2]}}
                    </option></select>
                </td>

                <input type=hidden name=index value="{{loop.index0}}">
                <input type=hidden name=referer value="{{request.url}}">
                <td><button type="submit">Remove</button></td>
            </tr>
        </form>
    {% endfor %}

    {% if anki.loaded %}
        <form class="anki-filter-row add-row" action="/anki/filter/add">
            <tr>
                <td>
                    <select name="deck">
                        <option value="*">Any</option>
                        {% for deck in anki.decks %}
                            <option value="{{deck}}">{{deck}}</option>
                        {% endfor %}
                    </select>
                </td>

                <td>
                    <select name="note_type">
                        <option value="*">Any</option>
                        {% for note in anki.note_types %}
                            <option value="{{note}}">{{note}}</option>
                        {% endfor %}
                    </select>
                </td>

                <td>
                    <select name="field">
                        {% for field in (anki.note_fields | sort) %}
                            <option value="{{field}}">{{field}}</option>
                        {% endfor %}
                    </select>
                </td>

                <input type=hidden name=referer value="{{request.url}}">
                <td><button type="submit">Add</button></td>
            </tr>
        </form>
    {% endif %}
</tbody></table>

{% if anki.loaded and (anki.filters or anki.learned_count) %}
    <p class="anki-learned-count accent">
        ✔ {{anki.learned|length}} learned words parsed
        ({{anki.young|length}} young, {{anki.mature|length}} mature)
    </p>
{% endif %}
