<h4>
    <a href="#{{img.as_anchor}}">{{img.name}}</a>
    {% if index1 > progress[0] %}
        <a
            href="{{force_refresh_url}}#{{img.as_anchor}}"
            title="OCR in progress, click to refresh"
        >‚ü≥</a>
    {% endif %}
</h4>

<div class=page>
    <img id="{{img.as_anchor}}" src="{{img.url()}}" loading=lazy>

    {% for group in path.ocr_box_groups(img) %}
        <div class=ocr-group>
        {% for box in group %}
            {% for kind in ["bg", "fg"] %}
                {% set font_size = "min(" ~
                    box.font_size ~ "px," ~
                    box.font_size * 100 / box.image_w ~ "vw" ~
                ")" %}
                <pre class=ocr-box-{{kind}} style="
                    left: {{box.x * 100}}%;
                    top: {{box.y * 100}}%;
                    {% if kind == 'fg' %}
                        width: {{box.w * 100}}%;
                        height: {{box.h * 100}}%;
                    {% else %}
                        min-width: {{box.w * 100}}%;
                        min-height: {{box.h * 100}}%;
                        outline-width: calc({{font_size}} / 3);
                    {% endif %}
                    font-size: {{font_size}};
                    {% if box.vertical %}
                        writing-mode: vertical-rl;
                        {# Affects normalized single width ?/!/etc #}
                        text-orientation: upright;
                    {% endif %}
                ">
                    {{"\n".join(box.lines)}}
                </pre>
            {% endfor %}
        {% endfor %}
        </div>
    {% endfor %}
</div>
